<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Water Drop Survivor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #FFF0F5; font-family: Arial, sans-serif; overflow: hidden; touch-action: none; }
    #canvas { display: block; background: #87CEEB; }
    #hud { position: absolute; top: 20px; left: 20px; color: #333; font-weight: bold; font-size: 18px; z-index: 10; }
    #hud div { margin: 5px 0; }
    .bar { width: 200px; height: 20px; background: #ddd; border: 2px solid #333; border-radius: 5px; overflow: hidden; }
    .bar-fill { height: 100%; background: #FF69B4; transition: width 0.2s; }
    #levelup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 40px; border-radius: 20px; color: white; text-align: center; z-index: 100; display: none; }
    .upgrade-btn { background: #667eea; color: white; border: none; padding: 15px; margin: 10px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; }
    .upgrade-btn:hover { background: #764ba2; }
    #gameover { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); padding: 40px; border-radius: 20px; color: white; text-align: center; z-index: 100; display: none; }
    #gameover h1 { font-size: 48px; color: #FFD700; margin-bottom: 20px; }
    #gameover button { background: #FF69B4; color: white; border: none; padding: 15px 30px; font-size: 20px; border-radius: 10px; cursor: pointer; margin-top: 20px; }
    .level-up-text { position: fixed; font-size: 60px; font-weight: bold; color: #FFD700; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); pointer-events: none; z-index: 99; animation: floatUp 1s ease-out forwards; }
    @keyframes floatUp { 0% { opacity: 1; transform: scale(0.8) translateY(0); } 100% { opacity: 0; transform: scale(1.5) translateY(-100px); } }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="hud">
    <div>Level: <span id="lvl">1</span></div>
    <div class="bar"><div class="bar-fill" id="hpbar" style="width: 100%"></div></div>
    <div>HP: <span id="hp">100</span>/100</div>
    <div>Kills: <span id="kills">0</span></div>
  </div>

  <div id="levelup">
    <h2 style="color: #FFD700;">‚≠ê LEVEL UP! ‚≠ê</h2>
    <p id="upgradelist"></p>
  </div>

  <div id="gameover">
    <h1>GAME OVER</h1>
    <p>Kills: <span id="finalKills">0</span></p>
    <p>Level: <span id="finalLevel">1</span></p>
    <button onclick="location.reload()">Play Again</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const game = {
      player: { x: canvas.width / 2, y: canvas.height / 2, radius: 15, hp: 100, maxHp: 100, level: 1, kills: 0, exp: 0 },
      enemies: [],
      projectiles: [],
      particles: [],
      weapons: { damage: 15, cooldown: 500, lastShot: 0, range: 150 },
      gameRunning: true,
      waveCount: 0
    };

    class Enemy {
      constructor(x, y, type = 0) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.radius = type === 0 ? 15 : type === 1 ? 10 : 12;
        this.hp = type === 0 ? 150 : type === 1 ? 40 : 80;
        this.speed = type === 0 ? 1.5 : type === 1 ? 4 : 2.5;
        this.color = type === 0 ? '#FF69B4' : type === 1 ? '#FFD700' : '#9370DB';
      }

      update() {
        const dx = game.player.x - this.x;
        const dy = game.player.y - this.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > 1) {
          this.x += (dx / dist) * this.speed;
          this.y += (dy / dist) * this.speed;
        }
        if (dist < 25) {
          game.player.hp -= 10;
        }
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      takeDamage(amount) {
        this.hp -= amount;
        return this.hp <= 0;
      }
    }

    class Projectile {
      constructor(fromX, fromY, toX, toY) {
        this.x = fromX;
        this.y = fromY;
        const dx = toX - fromX;
        const dy = toY - fromY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        this.vx = (dx / dist) * 5;
        this.vy = (dy / dist) * 5;
        this.radius = 5;
        this.life = 100;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life--;
        return this.life > 0;
      }

      draw() {
        ctx.fillStyle = '#FFFF00';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      checkCollision(enemy) {
        const dx = this.x - enemy.x;
        const dy = this.y - enemy.y;
        return Math.sqrt(dx*dx + dy*dy) < this.radius + enemy.radius;
      }
    }

    class Particle {
      constructor(x, y, vx, vy, color) {
        this.x = x;
        this.y = y;
        this.vx = vx;
        this.vy = vy;
        this.color = color;
        this.life = 30;
        this.radius = 3;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.1;
        this.life--;
        return this.life > 0;
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.globalAlpha = this.life / 30;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function spawnFountain() {
      for (let i = 0; i < 30; i++) {
        const angle = (Math.PI * 2 * i) / 30;
        const speed = 4 + Math.random() * 3;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed - 3;
        game.particles.push(new Particle(game.player.x, game.player.y, vx, vy, '#4ECDC4'));
      }

      const text = document.createElement('div');
      text.className = 'level-up-text';
      text.innerText = '‚≠ê LEVEL UP! ‚≠ê';
      text.style.left = (game.player.x - 100) + 'px';
      text.style.top = (game.player.y - 100) + 'px';
      document.body.appendChild(text);
      setTimeout(() => text.remove(), 1000);
    }

    function levelUp() {
      game.player.level++;
      game.player.exp = 0;
      game.player.maxHp += 20;
      game.player.hp = game.player.maxHp;

      spawnFountain();

      const modal = document.getElementById('levelup');
      const list = document.getElementById('upgradelist');
      list.innerHTML = `
        <button class="upgrade-btn" onclick="applyUpgrade('damage')">üí• +25% Damage</button>
        <button class="upgrade-btn" onclick="applyUpgrade('hp')">‚ù§Ô∏è +50 HP</button>
        <button class="upgrade-btn" onclick="applyUpgrade('range')">üéØ +30 Range</button>
        <button class="upgrade-btn" onclick="applyUpgrade('speed')">‚ö° -20% Cooldown</button>
      `;
      modal.style.display = 'block';
    }

    window.applyUpgrade = function(type) {
      if (type === 'damage') game.weapons.damage *= 1.25;
      else if (type === 'hp') { game.player.maxHp += 50; game.player.hp = game.player.maxHp; }
      else if (type === 'range') game.weapons.range += 30;
      else if (type === 'speed') game.weapons.cooldown *= 0.8;
      document.getElementById('levelup').style.display = 'none';
    };

    function spawnWave() {
      game.waveCount++;
      const count = 3 + Math.floor(game.waveCount / 2);
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const dist = 200;
        const x = game.player.x + Math.cos(angle) * dist;
        const y = game.player.y + Math.sin(angle) * dist;
        const type = Math.floor(Math.random() * 3);
        game.enemies.push(new Enemy(x, y, type));
      }
    }

    function gameOver() {
      game.gameRunning = false;
      document.getElementById('finalKills').innerText = game.player.kills;
      document.getElementById('finalLevel').innerText = game.player.level;
      document.getElementById('gameover').style.display = 'block';
    }

    function updateHUD() {
      document.getElementById('lvl').innerText = game.player.level;
      document.getElementById('hp').innerText = Math.ceil(game.player.hp);
      document.getElementById('kills').innerText = game.player.kills;
      document.getElementById('hpbar').style.width = (game.player.hp / game.player.maxHp * 100) + '%';
    }

    document.addEventListener('mousemove', (e) => {
      game.player.x = e.clientX;
      game.player.y = e.clientY;
    });

    document.addEventListener('touchmove', (e) => {
      game.player.x = e.touches[0].clientX;
      game.player.y = e.touches[0].clientY;
    });

    document.addEventListener('click', () => {
      if (game.gameRunning && Date.now() - game.weapons.lastShot > game.weapons.cooldown) {
        const nearest = game.enemies.reduce((a, b) => {
          const da = Math.hypot(a.x - game.player.x, a.y - game.player.y);
          const db = Math.hypot(b.x - game.player.x, b.y - game.player.y);
          return da < db ? a : b;
        }, game.enemies[0]);
        if (nearest) {
          game.projectiles.push(new Projectile(game.player.x, game.player.y, nearest.x, nearest.y));
          game.weapons.lastShot = Date.now();
        }
      }
    });

    let frameCount = 0;
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (game.gameRunning) {
        frameCount++;
        if (frameCount % 120 === 0) spawnWave();

        // Update
        game.enemies.forEach(e => e.update());
        game.projectiles = game.projectiles.filter(p => p.update());
        game.particles = game.particles.filter(p => p.update());

        // Collisions
        game.projectiles.forEach(p => {
          for (let i = 0; i < game.enemies.length; i++) {
            if (p.checkCollision(game.enemies[i])) {
              if (game.enemies[i].takeDamage(game.weapons.damage)) {
                game.player.kills++;
                game.player.exp += 10;
                if (game.player.exp >= game.player.level * 100) {
                  levelUp();
                }
                game.enemies.splice(i, 1);
              }
              game.projectiles = game.projectiles.filter(pp => pp !== p);
              break;
            }
          }
        });

        if (game.player.hp <= 0) gameOver();
      }

      // Draw
      ctx.fillStyle = '#4ECDC4';
      ctx.beginPath();
      ctx.arc(game.player.x, game.player.y, 15, 0, Math.PI * 2);
      ctx.fill();

      game.enemies.forEach(e => e.draw());
      game.projectiles.forEach(p => p.draw());
      game.particles.forEach(p => p.draw());

      updateHUD();
      requestAnimationFrame(gameLoop);
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    spawnWave();
    gameLoop();
  </script>
</body>
</html>